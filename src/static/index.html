<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>System Monitor Pro</title>
		<style>
			* { margin: 0; padding: 0; box-sizing: border-box; }
			body {
				font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
				background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
				color: #eee;
				min-height: 100vh;
				padding: 20px;
			}
			
			/* ç™»å½•ç•Œé¢ */
			#loginModal {
				position: fixed;
				top: 0; left: 0; width: 100%; height: 100%;
				background: rgba(0,0,0,0.9);
				display: flex;
				align-items: center;
				justify-content: center;
				z-index: 1000;
			}
			.login-box {
				background: rgba(255,255,255,0.05);
				backdrop-filter: blur(20px);
				padding: 40px;
				border-radius: 20px;
				border: 1px solid rgba(255,255,255,0.1);
				width: 90%;
				max-width: 400px;
			}
			.login-box h2 {
				text-align: center;
				margin-bottom: 30px;
				background: linear-gradient(45deg, #00d4ff, #7b2cbf);
				-webkit-background-clip: text;
				-webkit-text-fill-color: transparent;
			}
			.login-box input {
				width: 100%;
				padding: 15px;
				margin: 10px 0;
				background: rgba(255,255,255,0.05);
				border: 1px solid rgba(255,255,255,0.1);
				border-radius: 10px;
				color: #fff;
				font-size: 16px;
			}
			.login-box button {
				width: 100%;
				padding: 15px;
				margin-top: 20px;
				background: linear-gradient(45deg, #00d4ff, #7b2cbf);
				border: none;
				border-radius: 10px;
				color: #fff;
				font-size: 16px;
				font-weight: bold;
				cursor: pointer;
				transition: transform 0.3s;
			}
			.login-box button:hover { transform: scale(1.05); }
			.error-msg { color: #e74c3c; text-align: center; margin-top: 15px; }
			
			/* ä¸»ç•Œé¢ */
			#mainContent { display: none; }
			.header {
				text-align: center;
				margin-bottom: 30px;
			}
			.header h1 {
				font-size: 2.5rem;
				background: linear-gradient(45deg, #00d4ff, #7b2cbf);
				-webkit-background-clip: text;
				-webkit-text-fill-color: transparent;
			}
			
			/* èµ„æºç›‘æ§é¢æ¿ï¼ˆåˆå¹¶åŒºå—ï¼‰ */
			.resource-panel {
				background: rgba(255,255,255,0.05);
				backdrop-filter: blur(10px);
				border-radius: 20px;
				padding: 30px;
				border: 1px solid rgba(255,255,255,0.1);
				margin-bottom: 20px;
			}
			.panel-header {
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin-bottom: 25px;
				padding-bottom: 15px;
				border-bottom: 1px solid rgba(255,255,255,0.1);
			}
			.panel-title {
				font-size: 1.3rem;
				font-weight: bold;
				display: flex;
				align-items: center;
				gap: 10px;
			}
			
			/* èµ„æºç½‘æ ¼ */
			.resource-grid {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
				gap: 20px;
			}
			.resource-item {
				background: rgba(0,0,0,0.2);
				border-radius: 15px;
				padding: 20px;
				border: 1px solid rgba(255,255,255,0.05);
			}
			.resource-label {
				font-size: 0.85rem;
				color: #888;
				text-transform: uppercase;
				letter-spacing: 1px;
				margin-bottom: 10px;
				display: flex;
				align-items: center;
				gap: 8px;
			}
			.resource-value {
				font-size: 2rem;
				font-weight: bold;
				margin-bottom: 8px;
			}
			.progress-bar {
				width: 100%;
				height: 8px;
				background: rgba(255,255,255,0.1);
				border-radius: 4px;
				overflow: hidden;
			}
			.progress-fill {
				height: 100%;
				border-radius: 4px;
				transition: width 0.5s ease;
			}
			.cpu-fill { background: linear-gradient(90deg, #00d4ff, #0099cc); }
			.mem-fill { background: linear-gradient(90deg, #7b2cbf, #9d4edd); }
			.gpu-fill { background: linear-gradient(90deg, #f39c12, #e74c3c); }
			
			/* GPU è¯¦æƒ…å­ç½‘æ ¼ */
			.gpu-details {
				display: grid;
				grid-template-columns: repeat(2, 1fr);
				gap: 10px;
				margin-top: 15px;
				font-size: 0.85rem;
			}
			.gpu-detail-item {
				background: rgba(255,255,255,0.03);
				padding: 8px 12px;
				border-radius: 8px;
				display: flex;
				justify-content: space-between;
			}
			
			/* ç”µæ± æŒ‡ç¤ºå™¨ */
			.battery-indicator {
				display: flex;
				align-items: center;
				gap: 15px;
				background: rgba(0,0,0,0.2);
				padding: 15px 25px;
				border-radius: 50px;
				border: 1px solid rgba(255,255,255,0.1);
			}
			.battery-icon {
				font-size: 1.5rem;
			}
			.battery-text {
				font-size: 1.1rem;
				font-weight: bold;
			}
			.charging { color: #2ecc71; animation: pulse 2s infinite; }
			.not-charging { color: #f39c12; }
			
			/* å…¶ä»–å¡ç‰‡ */
			.grid {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
				gap: 20px;
			}
			.card {
				background: rgba(255,255,255,0.05);
				backdrop-filter: blur(10px);
				border-radius: 16px;
				padding: 24px;
				border: 1px solid rgba(255,255,255,0.1);
			}
			.card-title {
				font-size: 0.9rem;
				color: #888;
				text-transform: uppercase;
				letter-spacing: 1px;
				margin-bottom: 15px;
			}
			
			@keyframes pulse {
				0%, 100% { opacity: 1; }
				50% { opacity: 0.5; }
			}
			
			.logout-btn {
				background: rgba(255,255,255,0.1);
				border: 1px solid rgba(255,255,255,0.2);
				color: #fff;
				padding: 8px 20px;
				border-radius: 20px;
				cursor: pointer;
				transition: all 0.3s;
			}
			.logout-btn:hover {
				background: rgba(231, 76, 60, 0.3);
				border-color: #e74c3c;
			}
			
			.no-gpu {
				color: #666;
				font-style: italic;
				text-align: center;
				padding: 20px;
			}
		</style>
	</head>
	<body>
		<!-- ç™»å½•æ¨¡æ€æ¡† -->
		<div id="loginModal">
			<div class="login-box">
				<h2>ğŸ” System Monitor</h2>
				<input type="text" id="username" placeholder="ç”¨æˆ·å" value="admin">
				<input type="password" id="password" placeholder="å¯†ç " value="admin123">
				<button onclick="login()">ç™»å½•</button>
				<div class="error-msg" id="errorMsg"></div>
			</div>
		</div>

		<!-- ä¸»å†…å®¹ -->
		<div id="mainContent">
			<div class="header">
				<h1>ğŸ” System Monitor Pro</h1>
				<p>å®æ—¶ç³»ç»Ÿç›‘æ§é¢æ¿</p>
			</div>

			<!-- èµ„æºç›‘æ§é¢æ¿ï¼ˆCPU + å†…å­˜ + GPU åˆå¹¶ï¼‰ -->
			<div class="resource-panel">
				<div class="panel-header">
					<div class="panel-title">
						âš¡ æ ¸å¿ƒèµ„æºç›‘æ§
						<span id="batteryIndicator"></span>
					</div>
					<button class="logout-btn" onclick="logout()">é€€å‡ºç™»å½•</button>
				</div>

				<div class="resource-grid">
					<!-- CPU -->
					<div class="resource-item">
						<div class="resource-label">ğŸ–¥ï¸ CPU ä½¿ç”¨ç‡</div>
						<div class="resource-value" id="cpuValue">--%</div>
						<div class="progress-bar">
							<div class="progress-fill cpu-fill" id="cpuBar" style="width: 0%"></div>
						</div>
						<div style="margin-top: 10px; font-size: 0.85rem; color: #888;" id="cpuInfo">--</div>
					</div>

					<!-- å†…å­˜ -->
					<div class="resource-item">
						<div class="resource-label">ğŸ’¾ å†…å­˜ä½¿ç”¨</div>
						<div class="resource-value" id="memValue">--%</div>
						<div class="progress-bar">
							<div class="progress-fill mem-fill" id="memBar" style="width: 0%"></div>
						</div>
						<div style="margin-top: 10px; font-size: 0.85rem; color: #888;" id="memInfo">--</div>
					</div>

					<!-- GPU -->
					<div class="resource-item" style="grid-column: span 1;">
						<div class="resource-label">ğŸ® GPU çŠ¶æ€</div>
						<div id="gpuContent">
							<div class="no-gpu">æœªæ£€æµ‹åˆ° NVIDIA GPU</div>
						</div>
					</div>
				</div>
			</div>

			<!-- å…¶ä»–ä¿¡æ¯ -->
			<div class="grid">
				<div class="card">
					<div class="card-title">ğŸ’½ ç£ç›˜çŠ¶æ€</div>
					<div id="diskList"></div>
				</div>

				<div class="card">
					<div class="card-title">ğŸŒ ç½‘ç»œæµé‡</div>
					<div id="networkList"></div>
				</div>

				<div class="card">
					<div class="card-title">â„¹ï¸ ç³»ç»Ÿä¿¡æ¯</div>
					<div id="systemInfo" style="font-size: 0.9rem; line-height: 1.8; color: #aaa;"></div>
				</div>
			</div>
		</div>

		<script>
			let token = localStorage.getItem('monitor_token');
			let refreshInterval;
			
			// å¦‚æœæœ‰ tokenï¼Œç›´æ¥æ˜¾ç¤ºä¸»ç•Œé¢
			if (token) {
				showMain();
			}
			
			async function login() {
				const username = document.getElementById('username').value;
				const password = document.getElementById('password').value;
				
				try {
					const res = await fetch('/api/login', {
						method: 'POST',
						headers: { 'Content-Type': 'application/json' },
						body: JSON.stringify({ username, password })
						});
						
						const data = await res.json();
						
						if (res.ok) {
							token = data.token;
							localStorage.setItem('monitor_token', token);
							showMain();
							} else {
								document.getElementById('errorMsg').textContent = data.error || 'ç™»å½•å¤±è´¥';
							}
							} catch (e) {
								document.getElementById('errorMsg').textContent = 'ç½‘ç»œé”™è¯¯';
							}
						}
						
						function showMain() {
							document.getElementById('loginModal').style.display = 'none';
							document.getElementById('mainContent').style.display = 'block';
							fetchStats();
							refreshInterval = setInterval(fetchStats, 2000);
						}
						
						function logout() {
							localStorage.removeItem('monitor_token');
							location.reload();
						}
						
						async function fetchStats() {
							try {
								const res = await fetch('/api/stats', {
									headers: { 'Authorization': `Bearer ${token}` }
									});
									
									if (res.status === 401) {
										logout();
										return;
									}
									
									const data = await res.json();
									updateUI(data);
									} catch (e) {
										console.error('Fetch error:', e);
									}
								}
								
								function updateUI(data) {
									// æ›´æ–° CPU
									const cpu = data.resources;
									document.getElementById('cpuValue').textContent = cpu.cpu_usage.toFixed(1) + '%';
									document.getElementById('cpuBar').style.width = cpu.cpu_usage + '%';
									document.getElementById('cpuInfo').textContent =
									`${cpu.cpu_name} (${cpu.cpu_count} æ ¸)`;
									
									// æ›´æ–°å†…å­˜
									document.getElementById('memValue').textContent = cpu.memory_usage_percent.toFixed(1) + '%';
									document.getElementById('memBar').style.width = cpu.memory_usage_percent + '%';
									document.getElementById('memInfo').textContent =
									`å·²ç”¨: ${cpu.memory_used.toFixed(2)} GB / æ€»è®¡: ${cpu.memory_total.toFixed(2)} GB`;
									
									// æ›´æ–° GPU
									if (cpu.gpu) {
										const g = cpu.gpu;
										document.getElementById('gpuContent').innerHTML = `
										<div style="margin-bottom: 10px;">
										<div style="font-weight: bold; margin-bottom: 5px;">${g.name}</div>
										<div class="progress-bar" style="margin-bottom: 5px;">
										<div class="progress-fill gpu-fill" style="width: ${g.usage_percent}%"></div>
										</div>
										<div style="font-size: 0.9rem; color: #888;">
										åˆ©ç”¨ç‡: ${g.usage_percent}% | æ¸©åº¦: ${g.temperature}Â°C | åŠŸè€—: ${g.power_draw_watts}W
										</div>
										</div>
										<div class="gpu-details">
										<div class="gpu-detail-item">
										<span>æ˜¾å­˜å·²ç”¨</span>
										<span>${(g.memory_used_mb / 1024).toFixed(2)} GB</span>
										</div>
										<div class="gpu-detail-item">
										<span>æ˜¾å­˜æ€»è®¡</span>
										<span>${(g.memory_total_mb / 1024).toFixed(2)} GB</span>
										</div>
										</div>
										`;
									}
									
									// æ›´æ–°ç”µæ± 
									if (data.battery) {
										const b = data.battery;
										const icon = b.is_charging ? 'âš¡' : 'ğŸ”‹';
										const cls = b.is_charging ? 'charging' : 'not-charging';
										const time = b.time_remaining_minutes
										? `(${Math.floor(b.time_remaining_minutes / 60)}h ${b.time_remaining_minutes % 60}m)`
										: '';
										
										document.getElementById('batteryIndicator').innerHTML = `
										<div class="battery-indicator ${cls}">
										<span class="battery-icon">${icon}</span>
										<span class="battery-text">${b.percentage.toFixed(0)}% ${time}</span>
										</div>
										`;
									}
									
									// æ›´æ–°ç£ç›˜
									document.getElementById('diskList').innerHTML = data.disks.map(d => `
									<div style="margin-bottom: 15px;">
									<div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
									<span>${d.name}</span>
									<span>${d.usage_percent.toFixed(1)}%</span>
									</div>
									<div class="progress-bar">
									<div class="progress-fill" style="width: ${d.usage_percent}%; background: #3498db;"></div>
									</div>
									<div style="font-size: 0.8rem; color: #666; margin-top: 3px;">
									${d.used_gb.toFixed(1)} / ${d.total_gb.toFixed(1)} GB
									</div>
									</div>
									`).join('');
									
									// æ›´æ–°ç½‘ç»œ
									document.getElementById('networkList').innerHTML = data.networks.map(n => `
									<div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.05);">
									<span>${n.name}</span>
									<span style="color: #888;">â†“${n.received_mb}MB â†‘${n.transmitted_mb}MB</span>
									</div>
									`).join('');
									
									// æ›´æ–°ç³»ç»Ÿä¿¡æ¯
									document.getElementById('systemInfo').innerHTML = `
									<div>ä¸»æœºå: ${data.hostname}</div>
									<div>æ“ä½œç³»ç»Ÿ: ${data.os_version}</div>
									<div>è¿è¡Œæ—¶é—´: ${data.uptime_hours} å°æ—¶</div>
									${data.battery ? `<div>ç”µæ± å¥åº·: ${data.battery.health_percent.toFixed(1)}%</div>` : ''}
									`;
								}
								
								// é¡µé¢å¯è§æ€§å˜åŒ–æ—¶æš‚åœ/æ¢å¤åˆ·æ–°
								document.addEventListener('visibilitychange', () => {
									if (document.hidden) {
										clearInterval(refreshInterval);
										} else {
											refreshInterval = setInterval(fetchStats, 2000);
										}
										});
		</script>
	</body>
</html>
